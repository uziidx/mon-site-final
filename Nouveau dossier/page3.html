<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nour l'IA – Edu-trading</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <video autoplay muted loop id="background-video">
    <source src="https://videos.pexels.com/video-files/3141208/3141208-uhd_2560_1440_25fps.mp4" type="video/mp4" />
  </video>
<header>
  <div class="container header-container">
    <div class="logo-title">
      <!-- Lien autour du logo et du nom, sans effet visuel -->
      <a href="index.html" class="logo-link">
        <img src="images/logo.png" alt="Edu-trading" class="logo" />
        <h1 style="margin: 0; font-size: 1.5em; color: white;">Edu-trading</h1>
      </a>
    </div>
    <nav>
      <ul>
        <li><a href="index.html">Accueil</a></li>
        <li><a href="page4.html">Stratégies</a></li>
        <li><a href="page1.html">Courbes en direct</a></li>
        <li><a href="page3.html">Assistant IA</a></li>
        <li><a href="page2.html">Contact</a></li>
      </ul>
    </nav>
  </div>
</header>
  <main>
    <div class="container">
      <h2>Nour – Posez votre question</h2>
      <div id="chatbox"></div>
      <div id="typing"></div>
      <div id="controls">
        <input type="text" id="userInput" placeholder="Pose une question..." />
        <button onclick="sendMessage()">Envoyer</button>
      </div>
    </div>
  </main>
  <footer>
    <div class="container">
      <p>&copy; 2025 Edu Trading. Titouan Raymond / Reynald Watfa / Nour Abdelazim</p>
    </div>
  </footer>
  <script>
    const chatbox = document.getElementById("chatbox");
    const typing = document.getElementById("typing");
    async function sendMessage() {
      const input = document.getElementById("userInput");
      const message = input.value.trim();
      if (!message) return;
      chatbox.innerHTML += `<div class="msg user"><strong>Vous:</strong> ${message}</div>`;
      input.value = "";
      typing.innerText = "Nour le plus beau est en train de répondre...";
      try {
        const reply = await getGPTResponse(message);
        typing.innerText = "";
        const botMsg = document.createElement("div");
        botMsg.className = "msg bot";
        botMsg.innerHTML = `<strong>Ask Nour:</strong> <span id="botText"></span>`;
        chatbox.appendChild(botMsg);
        const botText = botMsg.querySelector("#botText");
        let i = 0;
        function typeEffect() {
          if (i < reply.length) {
            botText.textContent += reply.charAt(i);
            i++;
            setTimeout(typeEffect, 20);
          }
        }
        typeEffect();

        chatbox.scrollTop = chatbox.scrollHeight;
      } catch (error) {
        typing.innerText = "";
        chatbox.innerHTML += `<div class="msg bot"><strong>Ask Nour:</strong> Erreur lors de la réponse IA.<br><em>${error.message}</em></div>`;
        console.error("Erreur dans sendMessage:", error);
      }
    }
    async function getGPTResponse(message) {
      try {
        const response = await fetch("https://9e7ea643-37c2-4ead-a676-e73a8d2a7551-00-2fmvlx92yxpya.worf.replit.dev/ask", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });
        if (!response.ok) {
          const errorText = await response.text();
          throw new Error(`Erreur HTTP ${response.status}: ${errorText}`);
        }
        const data = await response.json();
        if (!data.reply) {
          throw new Error("Réponse vide de l'API");
        }
        return data.reply.trim();
      } catch (error) {
        throw error;
      }
    }
  </script>
</body>
</html>
